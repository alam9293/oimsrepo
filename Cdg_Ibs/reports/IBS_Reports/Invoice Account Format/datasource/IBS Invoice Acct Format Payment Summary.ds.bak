<?xml version="1.0" encoding="UTF-8"?>
<ds:datasource xmlns:ds="http://www.elixirtech.com/DataSource" name="IBS Invoice Acct Format Payment Summary" type="JDBC" description="">
  <ds:schema case-sensitive="Yes">
    <ds:column name="DUMMY_GROUP_HEADER" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="INVOICE_PAYMENT_NO" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="INVOICE_HEADER_NO" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="PAYMENT_AMOUNT" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="PAYMENT TYPE DESCRIPTION" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="PAYMENT TYPE REF NO" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="INVOICE_PAYMENT_DETAIL_NO" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="DETAIL PAYMENT DESCRIPTION" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="DETAIL PAYMENT AMOUNT" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
  </ds:schema>
  <ds:security />
  <ds:jdbc connection-type="POOL" connection-pool="/IBS_Reports/ConnectionPool/IBS Connection Pool.pool" connection-pool-timeout="0" callable-statement="No" connection-reuse="0" nulls-to-strings="No" read-only="Yes" auto-commit="Yes">
    <ds:sql>select
  'Dummy' DUMMY_GROUP_HEADER,
  biph.INVOICE_PAYMENT_NO,
  biph.INVOICE_HEADER_NO,
  biph.PAYMENT_AMOUNT,
  case biph.header_type
    when 'R' then 'PAYMENT RECEIVED'
    when 'C' then 'PAYMENT REVERSAL'
    when 'A' then 'EXCESS AMOUNT APPLIED'
    when 'F' then 'EXCESS AMOUNT REFUND'
  end "PAYMENT TYPE DESCRIPTION",
  case when biph.payment_type = 'CASH' then biph.payment_type
  else 
    case when biph.payment_ref_no is not null then biph.payment_type || '(' || biph.payment_ref_no || ')'
    else biph.payment_type
    end
  end "PAYMENT TYPE REF NO",
  bipd.invoice_payment_detail_no,
  case 
--when biph.header_type = 'C' then 'INVOICE ' || bipd.INVOICE_NO || ' - ' || bipd.ACCOUNT_NAME
    when biph.header_type = 'F' then 'REFUND - ' || biph.payment_ref_no
  else 
    case when bipd.ACCOUNT_NAME != '' then 'INVOICE ' || bipd.INVOICE_NO || ' - ' || bipd.ACCOUNT_NAME
    else 'INVOICE ' || bipd.INVOICE_NO
    end
  end "DETAIL PAYMENT DESCRIPTION",
  bipd.PAYMENT_AMOUNT "DETAIL PAYMENT AMOUNT"
from ${invoicePaymentHeaderTbl} biph
inner join ${invoicePaymentDetailTbl} bipd on biph.invoice_payment_no = bipd.invoice_payment_no
where biph.invoice_header_no = '${invoiceHeaderNo}'
order by biph.invoice_payment_no</ds:sql>
  </ds:jdbc>
</ds:datasource>

