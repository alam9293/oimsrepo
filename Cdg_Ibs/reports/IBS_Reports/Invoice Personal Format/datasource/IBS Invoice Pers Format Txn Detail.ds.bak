<?xml version="1.0" encoding="UTF-8"?>
<ds:datasource xmlns:ds="http://www.elixirtech.com/DataSource" name="IBS Invoice Pers Format Txn Detail" type="JDBC" description="">
  <ds:schema case-sensitive="Yes">
    <ds:column name="FAKE_GROUPING_HEADER" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="INVOICE_DETAIL_NAME" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="CARD_NO" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="CARD_CREDIT_LIMIT" type="Double">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="INVOICE_TXN_NO" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="INVOICE_DETAIL_NO" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="ACQUIRE_TXN_NO" type="Double">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="JOB_TYPE" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="JOB_REF_NO" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="FLIGHT_INFO" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="BOOKED_BY" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="TAXI_NO" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="PICKUP" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="DESTINATION" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="TXN_AMOUNT" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="ADMIN_FEE" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="ADMIN_FEE_PERCENT" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="GST" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="GST_PERCENT" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="TOTAL" type="Double">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="PASSENGER_NAME" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="SURCHARGE" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="TRIP_START_DT" type="Timestamp">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="TRIP_END_DT" type="Timestamp">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="ISSUED_INVOICE_HEADER_NO" type="Double">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="ISSUED_INVOICE_NO" type="Double">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="ISSUED_INVOICE_DATE" type="Date">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="NOTE" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="DESCRIPTION" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="PROJECT_CODE" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="BOOKING_REF" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="VEHICLE_TYPE" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="ORI_ADMIN_FEE" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="PROD_DIS_PERCENT" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="PROD_DIS_VALUE" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="PROMO_DIS_PERCENT" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="PROMO_DIS_VALUE" type="Double">
      <ds:attribute name="Nullable" nullable="no" />
    </ds:column>
    <ds:column name="ISSUED INVOICE" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="SORTING" type="Double">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="TRANSACTION_DESCRIPTION" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
  </ds:schema>
  <ds:security />
  <ds:jdbc connection-type="POOL" connection-pool="/IBS_Reports/ConnectionPool/IBS Connection Pool.pool" connection-pool-timeout="0" callable-statement="No" connection-reuse="0" nulls-to-strings="No" read-only="Yes" auto-commit="Yes">
    <ds:sql>Select
  'FAKE' FAKE_GROUPING_HEADER,
  bid.INVOICE_DETAIL_NAME,
  bid.CARD_NO,
  bid.CARD_CREDIT_LIMIT,
  bit.*,
  bit.ISSUED_INVOICE_NO || '  /  ' || to_char(bit.ISSUED_INVOICE_DATE,'DD/MM/YYYY') "ISSUED INVOICE",
  case when note is null then 0
  else 1 
  end sorting,
  case when bit.destination is not null then 'Ref: ' || bit.job_ref_no || ', ' || bit.taxi_no || ', ' || bit.pickup || ' TO ' || bit.destination 
  else 'Ref: ' || bit.job_ref_no || ', ' || bit.taxi_no || ', ' || bit.pickup
  end TRANSACTION_DESCRIPTION
From ${invoiceHeaderTbl} bih
inner join amtb_account debt_to_acct on bih.debt_to = debt_to_acct.account_no
inner join ${invoiceSummaryTbl} bis on bih.invoice_header_no = bis.invoice_header_no
inner join ${invoiceDetailTbl} bid on bid.invoice_summary_no = bis.invoice_summary_no
inner join ${invoiceTxnTbl} bit on bit.invoice_detail_no = bid.invoice_detail_no
inner join amtb_account aa on bid.account_no = aa.account_no
where bih.invoice_header_no = ${invoiceHeaderNo}
and bit.NOTE is null
order by sorting,
case when debt_to_acct.INVOICE_SORTING = 'C' then bit.CARD_NO end,
case when debt_to_acct.INVOICE_SORTING = 'C' then bit.TRIP_START_DT end,
case when debt_to_acct.INVOICE_SORTING = 'T' then bit.TRIP_START_DT end,
case when debt_to_acct.INVOICE_SORTING = 'T' then bit.CARD_NO end,
bit.JOB_REF_NO</ds:sql>
  </ds:jdbc>
</ds:datasource>

