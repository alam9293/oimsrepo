<?xml version="1.0" encoding="UTF-8"?>
<ds:datasource xmlns:ds="http://www.elixirtech.com/DataSource" name="Payment Receipt Detail" type="JDBC" description="">
  <ds:schema case-sensitive="Yes">
    <ds:column name="INVOICE_NO" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="AMOUNT" type="Double">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
    <ds:column name="QUANTITY" type="String">
      <ds:attribute name="Nullable" nullable="yes" />
    </ds:column>
  </ds:schema>
  <ds:security />
  <ds:jdbc connection-type="POOL" connection-pool="/IBS_Reports/ConnectionPool/IBS Connection Pool.pool" connection-pool-timeout="0" callable-statement="No" connection-reuse="0" nulls-to-strings="No" read-only="Yes" auto-commit="Yes">
    <ds:sql>select
    CASE WHEN header.INVOICE_TYPE ='TV' THEN
    	iir.QUANTITY || ' PCS OF ' ||iit.TYPE_NAME || '(SERIAL NO FROM '||iir.SERIAL_NO_START ||' TO '|| iir.SERIAL_NO_END ||')' 
    ELSE 
    'Invoice ' || header.INVOICE_NO 
    END as INVOICE_NO, applied.amount, iir.QUANTITY, iir.SERIAL_NO_START, iir.SERIAL_NO_END, header.IMTB_ISSUE_NO, header.INVOICE_TYPE,receipt.PAYMENT_RECEIPT_NO
from BMTB_PAYMENT_RECEIPT receipt
left join (select invoice_header_no, payment_receipt_no from bmtb_payment_receipt_detail group by invoice_header_no, payment_receipt_no) receipt_detail on receipt.PAYMENT_RECEIPT_NO = receipt_detail.PAYMENT_RECEIPT_NO
left join BMTB_INVOICE_HEADER header on receipt_detail.INVOICE_HEADER_NO = header.INVOICE_HEADER_NO
left join (select payment_receipt_no, invoice_header_no, sum(applied_amount) as amount from BMTB_PAYMENT_RECEIPT_DETAIL group by payment_receipt_no, invoice_header_no) applied on applied.PAYMENT_RECEIPT_NO = receipt.PAYMENT_RECEIPT_NO and applied.INVOICE_HEADER_NO = header.INVOICE_HEADER_NO
left join IMTB_ISSUE_REQ iir on iir.ISSUE_REQ_NO= header.IMTB_ISSUE_NO
left join IMTB_ITEM_TYPE iit on iit.ITEM_TYPE_NO = iir.ITEM_TYPE_NO
where
    receipt.PAYMENT_RECEIPT_NO = '${1. Receipt No}'</ds:sql>
  </ds:jdbc>
</ds:datasource>

