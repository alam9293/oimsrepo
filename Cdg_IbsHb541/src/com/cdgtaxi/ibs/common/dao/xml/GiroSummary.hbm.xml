<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD 3.0//EN" 
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
    
<hibernate-mapping>
<!-- 
    Created by the Middlegen Hibernate plugin 2.1

    http://boss.bekk.no/boss/middlegen/
    http://www.hibernate.org/
-->

<sql-query name="giroSummary">
	<return-scalar column="VALUE_DATE" 					type="string"/>
	<return-scalar column="GENERATION_DATE" 			type="string"/>
	<return-scalar column="UPLOAD_DATE"					type="string"/>
	<return-scalar column="ENTITY_NAME" 				type="string"/>
	<return-scalar column="GIRO_FILE_NAME"				type="string"/>
	<return-scalar column="RETURN_FILE_NAME" 			type="string"/>
	<return-scalar column="OUTGOING_COUNT" 				type="string"/>
	<return-scalar column="OUTGOING_AMOUNT"				type="string"/>
	<return-scalar column="INCOMING_COUNT" 				type="string"/>
	<return-scalar column="INCOMING_AMOUNT" 			type="string"/>
	<return-scalar column="INCOMING_SUCCESS_COUNT" 		type="string"/>
	<return-scalar column="INCOMING_SUCCESS_AMOUNT" 	type="string"/>
	<return-scalar column="INCOMING_REJECTED_COUNT" 	type="string"/>
	<return-scalar column="INCOMING_REJECTED_AMOUNT"	type="string"/>
	<![CDATA[
	select
		to_char(hdr.VALUE_DATE,'dd/MM/yyyy') as VALUE_DATE,
		to_char(hdr.GENERATION_DATE,'dd/MM/yyyy') as GENERATION_DATE,
		to_char(hdr.UPLOAD_DATE,'dd/MM/yyyy') AS UPLOAD_DATE,
		entity.ENTITY_NAME,
		hdr.GIRO_FILE_NAME,
		hdr.RETURN_FILE_NAME,
		hdr.OUTGOING_COUNT,
		hdr.OUTGOING_AMOUNT,
		NVL(hdr.INCOMING_SUCCESS_COUNT,0) + NVL(hdr.INCOMING_REJECTED_COUNT,0) AS INCOMING_COUNT,
		NVL(hdr.INCOMING_SUCCESS_AMOUNT,0) + NVL(hdr.INCOMING_REJECTED_AMOUNT,0) AS INCOMING_AMOUNT,
		hdr.INCOMING_SUCCESS_COUNT,
		hdr.INCOMING_SUCCESS_AMOUNT,
		hdr.INCOMING_REJECTED_COUNT,
		hdr.INCOMING_REJECTED_AMOUNT
	from ITTB_GIRO_UOB_HEADER hdr
	inner join ITTB_GIRO_REQ req on hdr.REQ_NO = req.REQ_NO
	inner join ITTB_GIRO_SETUP setup on req.SETUP_NO = setup.SETUP_NO
	inner join FMTB_ENTITY_MASTER entity on setup.ENTITY_NO = entity.ENTITY_NO
	where
		(:entityNo is null OR :entityNo = entity.ENTITY_NO)
		AND
		(:valueDateFrom is null OR hdr.VALUE_DATE between to_date(:valueDateFrom,'yyyy-MM-dd') AND to_date(:valueDateTo,'yyyy-MM-dd'))
		AND
		(:generationDateFrom is null OR hdr.GENERATION_DATE between to_date(:generationDateFrom,'yyyy-MM-dd') AND to_date(:generationDateTo,'yyyy-MM-dd'))
		AND
		(:uploadDateFrom is null OR hdr.UPLOAD_DATE between to_date(:uploadDateFrom,'yyyy-MM-dd') AND to_date(:uploadDateTo,'yyyy-MM-dd'))
	order by
		hdr.VALUE_DATE, entity.ENTITY_NAME
	]]>
</sql-query>

</hibernate-mapping>
