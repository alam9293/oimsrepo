<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD 3.0//EN" 
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
    
<hibernate-mapping>
<!-- 
    Created by the Middlegen Hibernate plugin 2.1

    http://boss.bekk.no/boss/middlegen/
    http://www.hibernate.org/
-->

<class 
    name="com.cdgtaxi.ibs.common.model.BmtbInvoiceHeader" 
    table="BMTB_INVOICE_HEADER"
    dynamic-update="true"
    dynamic-insert="true"
>
    <meta attribute="implement-equals" inherit="false">true</meta>

    <id
        name="invoiceHeaderNo"
        type="java.lang.Long"
        column="INVOICE_HEADER_NO"
    >
        <meta attribute="use-in-equals">true</meta>
        <generator class="sequence">
            <param name="sequence_name">BMTB_INVOICE_HEADER_SQ1</param>
        </generator>
    </id>
    <version name="version" column="VERSION"/>

    <property
        name="invoiceNo"
        type="java.lang.Long"
        column="INVOICE_NO"
        length="18"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="invoiceDate"
        type="java.sql.Date"
        column="INVOICE_DATE"
        not-null="true"
        length="7"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="invoiceStatus"
        type="java.lang.String"
        column="INVOICE_STATUS"
        not-null="true"
        length="1"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="invoiceFormat"
        type="java.lang.String"
        column="INVOICE_FORMAT"
        not-null="true"
        length="2"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="dueDate"
        type="java.sql.Date"
        column="DUE_DATE"
        length="7"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="statementPeriodFromDate"
        type="java.sql.Date"
        column="STATEMENT_PERIOD_FROM_DATE"
        length="7"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="statementPeriodToDate"
        type="java.sql.Date"
        column="STATEMENT_PERIOD_TO_DATE"
        length="7"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="prevBalance"
        type="java.math.BigDecimal"
        column="PREV_BALANCE"
        not-null="true"
        length="12"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="prevPayment"
        type="java.math.BigDecimal"
        column="PREV_PAYMENT"
        not-null="true"
        length="12"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="newTxn"
        type="java.math.BigDecimal"
        column="NEW_TXN"
        not-null="true"
        length="12"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="newBalance"
        type="java.math.BigDecimal"
        column="NEW_BALANCE"
        not-null="true"
        length="12"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="less30Days"
        type="java.math.BigDecimal"
        column="LESS_30_DAYS"
        not-null="true"
        length="12"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="less60Days"
        type="java.math.BigDecimal"
        column="LESS_60_DAYS"
        not-null="true"
        length="12"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="less90Days"
        type="java.math.BigDecimal"
        column="LESS_90_DAYS"
        not-null="true"
        length="12"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="more90Days"
        type="java.math.BigDecimal"
        column="MORE_90_DAYS"
        not-null="true"
        length="12"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="prevRewardsPts"
        type="java.lang.Integer"
        column="PREV_REWARDS_PTS"
        length="8"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="redeemedRewardsPts"
        type="java.lang.Integer"
        column="REDEEMED_REWARDS_PTS"
        length="8"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="newRewardsPts"
        type="java.lang.Integer"
        column="NEW_REWARDS_PTS"
        length="8"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="totalRewardsPts"
        type="java.lang.Integer"
        column="TOTAL_REWARDS_PTS"
        length="8"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="awardedRewardsPts"
        type="java.lang.Integer"
        column="AWARDED_REWARDS_PTS"
        length="8"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="expiredRewardsPts"
        type="java.lang.Integer"
        column="EXPIRED_REWARDS_PTS"
        length="8"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="adjustedRewardsPts"
        type="java.lang.Integer"
        column="ADJUSTED_REWARDS_PTS"
        length="8"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="forfeitedRewardsPts"
        type="java.lang.Integer"
        column="FORFEITED_REWARDS_PTS"
        length="8"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="toExpireRewardsPts"
        type="java.lang.Integer"
        column="TO_EXPIRE_REWARDS_PTS"
        length="8"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="rewardsExpiryDate"
        type="java.sql.Timestamp"
        column="ReWARDS_EXPIRY_DATE"
        length="11"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="accountDeposit"
        type="java.math.BigDecimal"
        column="ACCOUNT_DEPOSIT"
        length="12"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="accountExcess"
        type="java.math.BigDecimal"
        column="ACCOUNT_EXCESS"
        length="12"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="overdueInvoice"
        type="java.lang.String"
        column="OVERDUE_INVOICE"
        length="500"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="txnCutoffDate"
        type="java.sql.Date"
        column="TXN_CUTOFF_DATE"
        length="7"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="latePaymentInterest"
        type="java.math.BigDecimal"
        column="LATE_PAYMENT_INTEREST"
        not-null="true"
        length="5"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="latePaymentAmount"
        type="java.math.BigDecimal"
        column="LATE_PAYMENT_AMOUNT"
        not-null="true"
        length="12"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="lastLatePaymentChargedDate"
        type="java.sql.Date"
        column="LAST_LATE_PAYMENT_CHARGED_DATE"
        length="7"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="earlyPaymentFlag"
        type="java.lang.String"
        column="EARLY_PAYMENT_FLAG"
        not-null="true"
        length="1"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="latePaymentFlag"
        type="java.lang.String"
        column="LATE_PAYMENT_FLAG"
        not-null="true"
        length="1"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="outstandingAmount"
        type="java.math.BigDecimal"
        column="OUTSTANDING_AMOUNT"
        not-null="true"
        length="12"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="totalFareAmount"
        type="java.math.BigDecimal"
        column="TOTAL_FARE_AMOUNT"
        not-null="true"
        length="12"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="totalNoOfTrip"
        type="int"
        column="TOTAL_NO_OF_TRIP"
        not-null="true"
        length="8"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="remarks"
        type="java.lang.String"
        column="REMARKS"
        length="500"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="billedFlag"
        type="java.lang.String"
        column="BILLED_FLAG"
        length="1"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="giroBankAcctNo"
        type="java.lang.String"
        column="GIRO_BANK_ACCT_NO"
        length="100"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="giroDay"
        type="java.lang.String"
        column="GIRO_DAY"
        length="4"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="createdBy"
        type="java.lang.String"
        column="CREATED_BY"
        length="80"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="createdDt"
        type="java.sql.Timestamp"
        column="CREATED_DT"
        length="11"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="updatedBy"
        type="java.lang.String"
        column="UPDATED_BY"
        length="80"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="updatedDt"
        type="java.sql.Timestamp"
        column="UPDATED_DT"
        length="11"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
	<property
        name="prepaidFlag"
        type="java.lang.String"
        column="PREPAID_FLAG"
        length="10"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="cancelDt"
        type="java.sql.Timestamp"
        column="CANCEL_DT"
        length="11"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="invoiceType"
        type="java.lang.String"
        column="INVOICE_TYPE"
        length="2"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    <property
        name="currentTaxRate"
        type="java.math.BigDecimal"
        column="CURRENT_TAX_RATE"
        length="5"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
     <property
        name="recurringDoneFlag"
        type="java.lang.String"
        column="RECURRING_DONE_FLAG"
        length="1"
    >
        <meta attribute="use-in-tostring">true</meta>
        <meta attribute="use-in-equals">true</meta>
    </property>
    
    <!-- Associations -->
  
    <!-- bi-directional one-to-many association to LrtbRewardTxn -->
    <set
        name="lrtbRewardTxns"
        lazy="true"
        inverse="true"
		cascade="all"
    >
        <key>
            <column name="INVOICE_HEADER_NO" />
        </key>
        <one-to-many 
            class="com.cdgtaxi.ibs.common.model.LrtbRewardTxn"
        />
    </set>
    <!-- bi-directional one-to-many association to BmtbInvoicePaymentHeader -->
    <set
        name="bmtbInvoicePaymentHeaders"
        lazy="true"
        inverse="true"
		cascade="all"
    >
        <key>
            <column name="INVOICE_HEADER_NO" />
        </key>
        <one-to-many 
            class="com.cdgtaxi.ibs.common.model.BmtbInvoicePaymentHeader"
        />
    </set>
    <!-- bi-directional one-to-many association to BmtbPaymentReceiptDetail -->
    <set
        name="bmtbPaymentReceiptDetails"
        lazy="true"
        inverse="true"
		cascade="all"
    >
        <key>
            <column name="INVOICE_HEADER_NO" />
        </key>
        <one-to-many 
            class="com.cdgtaxi.ibs.common.model.BmtbPaymentReceiptDetail"
        />
    </set>
    <!-- bi-directional one-to-many association to BmtbLastInvoiceLog -->
    <set
        name="bmtbLastInvoiceLogs"
        lazy="true"
        inverse="true"
		cascade="all"
    >
        <key>
            <column name="INVOICE_HEADER_NO" />
        </key>
        <one-to-many 
            class="com.cdgtaxi.ibs.common.model.BmtbLastInvoiceLog"
        />
    </set>
    <!-- bi-directional one-to-many association to BmtbInvoiceSummary -->
    <set
        name="bmtbInvoiceSummaries"
        lazy="true"
        inverse="true"
		cascade="all"
    >
        <key>
            <column name="INVOICE_HEADER_NO" />
        </key>
        <one-to-many 
            class="com.cdgtaxi.ibs.common.model.BmtbInvoiceSummary"
        />
    </set>
    <!-- bi-directional one-to-many association to FmtbGlLogDetail -->
    <set
        name="fmtbGlLogDetails"
        lazy="true"
        inverse="true"
		cascade="all"
    >
        <key>
            <column name="INVOICE_HEADER_NO" />
        </key>
        <one-to-many 
            class="com.cdgtaxi.ibs.common.model.FmtbGlLogDetail"
        />
    </set>
    <!-- bi-directional one-to-many association to BmtbNote -->
    <set
        name="bmtbNotes"
        lazy="true"
        inverse="true"
		cascade="all"
    >
        <key>
            <column name="ISSUED_INVOICE_HEADER_NO" />
        </key>
        <one-to-many 
            class="com.cdgtaxi.ibs.common.model.BmtbNote"
        />
    </set>
    <!-- bi-directional one-to-many association to BmtbInvoiceTxn -->
    <set
        name="bmtbInvoiceTxns"
        lazy="true"
        inverse="true"
		cascade="all"
    >
        <key>
            <column name="ISSUED_INVOICE_HEADER_NO" />
        </key>
        <one-to-many 
            class="com.cdgtaxi.ibs.common.model.BmtbInvoiceTxn"
        />
    </set>
    <!-- bi-directional one-to-many association to BmtbInvoiceDepositTxn -->
    <set
        name="bmtbInvoiceDepositTxns"
        lazy="true"
        inverse="true"
		cascade="all"
    >
        <key>
            <column name="INVOICE_HEADER_NO" />
        </key>
        <one-to-many 
            class="com.cdgtaxi.ibs.common.model.BmtbInvoiceDepositTxn"
        />
    </set>
    <!-- bi-directional many-to-one association to AmtbAccount -->
    <many-to-one
        name="amtbAccountByAccountNo"
        class="com.cdgtaxi.ibs.common.model.AmtbAccount"
        not-null="true"
    >
        <meta attribute="use-in-equals">true</meta>
        <column name="ACCOUNT_NO" />
    </many-to-one>
    <!-- bi-directional many-to-one association to AmtbAccount -->
    <many-to-one
        name="amtbAccountByDebtTo"
        class="com.cdgtaxi.ibs.common.model.AmtbAccount"
        not-null="true"
    >
        <meta attribute="use-in-equals">true</meta>
        <column name="DEBT_TO" />
    </many-to-one>
    <!-- bi-directional many-to-one association to BmtbBillGenReq -->
    <many-to-one
        name="bmtbBillGenReq"
        class="com.cdgtaxi.ibs.common.model.BmtbBillGenReq"
        not-null="true"
    >
        <meta attribute="use-in-equals">true</meta>
        <column name="REQ_NO" />
    </many-to-one>
    <!-- bi-directional many-to-one association to BmtbInvoiceFile -->
    <many-to-one
        name="bmtbInvoiceFile"
        class="com.cdgtaxi.ibs.common.model.BmtbInvoiceFile"
    >
        <meta attribute="use-in-equals">true</meta>
        <column name="FILE_NO" />
    </many-to-one>
	<set
        name="pmtbPrepaidReqs"
        lazy="true"
        inverse="true"
		cascade="all"
    >
        <key>
            <column name="BMTB_INVOICE_HEADER" />
        </key>
        <one-to-many 
            class="com.cdgtaxi.ibs.common.model.PmtbPrepaidReq"
        />
    </set>
    <many-to-one
        name="imtbIssue"
        class="com.cdgtaxi.ibs.common.model.ImtbIssue"
    >
        <meta attribute="use-in-equals">true</meta>
        <column name="IMTB_ISSUE_NO" />
    </many-to-one>
</class>

<sql-query name="getTotalOutstandingAmount">
<return-scalar column="total_outstanding_amount" type="java.math.BigDecimal"/>
 <![CDATA[
	select sum(h.outstanding_amount) as total_outstanding_amount
	from bmtb_invoice_header h
	where
  		h.account_no in (
    		select account_no
    		from amtb_account
    		where account_no = :accountNo
    		union
    		select account_no
    		from amtb_account
    		where parent_no = :accountNo
    		UNION
    		select a1.account_no
    		from amtb_account a1
    		inner join amtb_account a2 on a1.parent_no = a2.account_no
    		where a2.parent_no = :accountNo
  		)
  		and
  		h.outstanding_amount > 0
]]>
</sql-query>

<sql-query name="getTotalDueOutstandingAmount">
<return-scalar column="total_outstanding_amount" type="java.math.BigDecimal"/>
 <![CDATA[
	select sum(h.outstanding_amount) as total_outstanding_amount
	from bmtb_invoice_header h
	where
  		h.account_no in (
    		select account_no
    		from amtb_account
    		where account_no = :accountNo
    		union
    		select account_no
    		from amtb_account
    		where parent_no = :accountNo
    		UNION
    		select a1.account_no
    		from amtb_account a1
    		inner join amtb_account a2 on a1.parent_no = a2.account_no
    		where a2.parent_no = :accountNo
  		)
  		and
  		h.outstanding_amount > 0
  		and
  		h.due_date <= :paidInvoiceDueDate
]]>
</sql-query>

<sql-query name="getInvoicesToRewardEarlyPayment">
<return-scalar column="invoice_header_no" type="java.lang.Long"/>
 <![CDATA[
	select distinct(h.invoice_header_no)
	from bmtb_invoice_header h
	inner join bmtb_invoice_summary s on h.invoice_header_no = s.invoice_header_no
	where
  		h.account_no in (
    		select account_no
    		from amtb_account
    		where account_no = :accountNo
    		union
    		select account_no
    		from amtb_account
    		where parent_no = :accountNo
    		UNION
    		select a1.account_no
    		from amtb_account a1
    		inner join amtb_account a2 on a1.parent_no = a2.account_no
    		where a2.parent_no = :accountNo
  		)
  		and
  		h.LATE_PAYMENT_FLAG = 'N'
  		and
  		h.EARLY_PAYMENT_FLAG = 'N'
  		and
  		h.OUTSTANDING_AMOUNT = 0
  		and
  		(
  			s.SUMMARY_TYPE is null
  			or
  			s.SUMMARY_TYPE not in ('LP','VD','DP','EP')
  		)
  		and
  		s.NEW_TXN > 0
  		and
  		h.DUE_DATE >= trunc(sysdate)
]]>
</sql-query>

<sql-query name="getNotBilledEarlyPaymentInvoices">
<return-scalar column="invoice_header_no" type="java.lang.Long"/>
 <![CDATA[
	select distinct(h.invoice_header_no)
	from bmtb_invoice_header h
	where
  		h.account_no in (
    		select account_no
    		from amtb_account
    		where account_no = :accountNo
    		union
    		select account_no
    		from amtb_account
    		where parent_no = :accountNo
    		UNION
    		select a1.account_no
    		from amtb_account a1
    		inner join amtb_account a2 on a1.parent_no = a2.account_no
    		where a2.parent_no = :accountNo
  		)
  		and
  		h.EARLY_PAYMENT_FLAG = 'Y'
  		and
  		h.DUE_DATE >= :cancelInvoiceDueDate
]]>
</sql-query>

</hibernate-mapping>
