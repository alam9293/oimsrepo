package com.webapp.ims.login.controller;

import javax.servlet.http.HttpSession;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.ModelAndView;

import com.webapp.ims.login.model.Login;
import com.webapp.ims.login.service.LoginService;

@Controller
public class LoginController {
	private final Logger logger = LoggerFactory.getLogger(LoginController.class);

	@Autowired
	private LoginService loginService;

	@RequestMapping(value = "/login", method = RequestMethod.GET)
	public ModelAndView login(Model model) {

		logger.info("Initilize show login Process!");

		model.addAttribute("login", new Login());
		logger.info("Exited login Process!");
		return new ModelAndView("login");

	}

	@RequestMapping(value = "/UserLogin", method = RequestMethod.POST)
	public ModelAndView UserLogin(@ModelAttribute("login") @Validated Login login, BindingResult result, Model model,
			HttpSession session) {

		logger.debug("Initilize Login Processing!");
		String userName = login.getUserName().trim();
		String password = login.getPassword();
		String department = login.getDepartment();
		String role = ""; // login.getRole();
		Login loginUser = loginService.getLoginNameByuserName(userName, department);

		if (loginUser != null && userName.equalsIgnoreCase(loginUser.getUserName().trim())
				&& password.equalsIgnoreCase(loginUser.getPassword().trim())) {
			session.setAttribute("userName", loginUser.getFirstName() + " " + loginUser.getLastName());
			session.setAttribute("userId", String.valueOf(loginUser.getId()));
			role = loginUser.getRole();
			session.setAttribute("role", loginUser.getRole());

			model.addAttribute("login", new Login());
			if (department.trim().equalsIgnoreCase("PICUP Processing Team")) {
				return new ModelAndView("redirect:/dashboard");
			} else if (department.trim().equalsIgnoreCase("JMD PICUP")) {
				return new ModelAndView("redirect:/dashboardJMDPICUP");
			}

			else if (department.trim().equalsIgnoreCase("DIC")) {
				return new ModelAndView("redirect:/dicDepartmentDashboard");
			} else if (department.trim().equalsIgnoreCase("MD PICUP")) {
				return new ModelAndView("redirect:/dashboardMDPICUP");
			} else if (department.trim().equalsIgnoreCase("Head of Nodal Department IIEPP-2017")) {
				return new ModelAndView("redirect:/nodalDeptHeadDashboard");
			} else if (department.trim().equalsIgnoreCase("Concerned JCI IIEPP-2017")) {
				return new ModelAndView("redirect:/dashboardCONCERJCIDEPARTMENT");
			} else if (department.trim().equalsIgnoreCase("PSI")) {
				return new ModelAndView("redirect:/dashboardPSI");

			} else if (department.trim().equalsIgnoreCase("CS")) {
				return new ModelAndView("redirect:/dashboardCS");
			} else if (department.trim().equalsIgnoreCase("ID6")) {
				return new ModelAndView("redirect:/dashboardID6");

			} else if (department.trim().equalsIgnoreCase("ConcernedDepartments") && role != null && role != "NA")
				if (role.contains("ConDept25")) {

					return new ModelAndView("redirect:/electricityDashboard");
				}

				else if (department.trim().equalsIgnoreCase("ConcernedDepartments") && role != null && role != "NA")
					if (role.contains("ConDept2")) {
						return new ModelAndView("redirect:/departmentDashboard");
					} else if (department.trim().equalsIgnoreCase("ConcernedDepartments") && role != null
							&& role != "NA")
						if (role.contains("ConDept0")) {
							return new ModelAndView("redirect:/aggricultureDashboard");
						} else if (department.trim().equalsIgnoreCase("ConcernedDepartments") && role != null
								&& role != "NA")
							if (role.contains("ConDept4")) {
								return new ModelAndView("redirect:/labourDashboard");
							} else if (department.trim().equalsIgnoreCase("ConcernedDepartments") && role != null
									&& role != "NA")
								if (role.contains("ConDept4")) {
									return new ModelAndView("redirect:/labourDashboard");
								}

								else if (department.trim().equalsIgnoreCase("ConcernedDepartments") && role != null
										&& role != "NA")
									if (role.contains("ConDept5")) {
										return new ModelAndView("redirect:/stampDutyDashboard");
									} else {
										model.addAttribute("userName", "");
										model.addAttribute("password", "");
										model.addAttribute("captcha", "");
										model.addAttribute("department", "");
										model.addAttribute("message", "User name and Password is Incorrect.");
										return new ModelAndView("login");
									}
		} else {

			model.addAttribute("userName", "");
			model.addAttribute("password", "");
			model.addAttribute("captcha", "");
			model.addAttribute("department", "");
			model.addAttribute("message", "User name and Password is Incorrect.");
			return new ModelAndView("login");
		}
		return new ModelAndView("login");

	}

	@RequestMapping(value = "/userLogout", method = RequestMethod.GET)
	public ModelAndView logout(HttpSession session) {
		session.removeAttribute("userName");
		return new ModelAndView("redirect:/login");
	}
}
